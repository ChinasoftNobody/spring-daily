<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lgh.spring.boot.mapper.finance.IncomeMapper">
    <resultMap id="base" type="com.lgh.spring.boot.model.MBase">
        <id column="id" property="id"/>
        <result column="del" property="del"/>
        <result column="createOn" property="createOn"/>
        <result column="updateOn" property="updateOn"/>
    </resultMap>
    <resultMap id="frequencyResultMap" type="com.lgh.spring.boot.model.finance.MIncomeCardFrequency">
        <result property="count" column="frequency_count"/>
        <result property="unit" column="frequency_unit"/>
    </resultMap>
    <resultMap id="incomeResultMap" type="com.lgh.spring.boot.model.finance.MIncomeCard" extends="base">
        <result  property="subject" column="subject"/>
        <result  property="amount" column="amount"/>
        <result  property="description" column="description"/>
        <association property="frequency" resultMap="frequencyResultMap"/>
    </resultMap>

    <!-- query by key -->
    <select id="queryCards" resultMap="incomeResultMap" parameterType="java.lang.String">
        select id,subject,description,amount,frequency_count,frequency_unit,del,createOn,updateOn from t_finance_income
        <if test="keyword != null and keyword != ''">
            <where>
                subject like concat('%/',#{keyword},'%') escape '/'
            </where>
        </if> order by updateOn desc;
    </select>

    <!-- createCard -->
    <insert id="createCard" useGeneratedKeys="true" keyProperty="card.id" parameterType="com.lgh.spring.boot.model.finance.MIncomeCard">
      insert into t_finance_income(subject,description,amount,frequency_count,frequency_unit)
      values (#{card.subject},#{card.description},#{card.amount},#{card.frequency.count},#{card.frequency.unit});
    </insert>
</mapper>